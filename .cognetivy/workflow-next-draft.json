{
  "workflow_id": "wf_default",
  "version": "v0",
  "nodes": [
    {
      "id": "set_scope_and_success_criteria",
      "type": "TASK",
      "contract": {
        "input": ["current_repo_state", "user_pain_points"],
        "output": ["requirements", "acceptance_criteria", "step_article"]
      },
      "description": "Clarify what 'v2' means, list non-negotiables, and define measurable acceptance criteria (schemas, ids/names, statuses, refs, multi-research support). Append one step_article plus requirements + acceptance_criteria items."
    },
    {
      "id": "inventory_current_model_and_gaps",
      "type": "TASK",
      "contract": {
        "input": ["workflow_v1", "collection_schema_v1", "studio_expectations"],
        "output": ["gap_list", "decisions", "step_article"]
      },
      "description": "Deep-dive current workflow/run/event/collection model + Studio behavior. Produce a gap_list mapped to your checklist; record decisions (what stays, what changes) with rationale. Append one step_article."
    },
    {
      "id": "design_v2_information_architecture",
      "type": "TASK",
      "contract": {
        "input": ["requirements", "gap_list"],
        "output": ["workflow_spec", "collection_kinds_spec", "naming_conventions", "step_article"]
      },
      "description": "Design the v2 information architecture: workflow metadata (name/description/type), node metadata (id + display name), collection traceability fields, and naming/versioning conventions. Append one step_article."
    },
    {
      "id": "define_strict_schemas_and_refs",
      "type": "TASK",
      "contract": {
        "input": ["workflow_spec", "collection_kinds_spec"],
        "output": ["schema_v2_proposal", "ref_model", "validation_rules", "step_article"]
      },
      "description": "Define strict collection schemas (required fields, enums via conventions), plus a reference model (refs/prisms) that links sources <-> step articles <-> collected items. Append one step_article."
    },
    {
      "id": "human_review_gate",
      "type": "TASK",
      "contract": {
        "input": ["schema_v2_proposal", "workflow_spec", "validation_rules"],
        "output": ["approved_changes", "open_questions", "step_article"]
      },
      "description": "Human review checkpoint. Confirm the proposed shapes/names/required fields and record any open questions. Append one step_article; append decisions for approvals."
    },
    {
      "id": "plan_migrations_and_backwards_compat",
      "type": "TASK",
      "contract": {
        "input": ["approved_changes", "current_repo_state"],
        "output": ["migration_plan", "compat_strategy", "step_article"]
      },
      "description": "Plan migration steps from v1 -> v2 (data shape, Studio display, CLI validation). Define backward compatibility strategy and incremental rollout. Append one step_article."
    },
    {
      "id": "execution_plan_and_task_breakdown",
      "type": "TASK",
      "contract": {
        "input": ["migration_plan", "compat_strategy"],
        "output": ["implementation_tasks", "test_plan", "step_article"]
      },
      "description": "Convert the plan into executable tasks (small PR-sized items), with a test plan. Ensure 'data is appended 1-by-1' and 'run loop between nodes' are operationalized as events/commands. Append one step_article."
    }
  ],
  "edges": [
    { "from": "set_scope_and_success_criteria", "to": "inventory_current_model_and_gaps" },
    { "from": "inventory_current_model_and_gaps", "to": "design_v2_information_architecture" },
    { "from": "design_v2_information_architecture", "to": "define_strict_schemas_and_refs" },
    { "from": "define_strict_schemas_and_refs", "to": "human_review_gate" },
    { "from": "human_review_gate", "to": "plan_migrations_and_backwards_compat" },
    { "from": "plan_migrations_and_backwards_compat", "to": "execution_plan_and_task_breakdown" }
  ]
}
